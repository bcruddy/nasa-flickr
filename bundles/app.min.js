"use strict";function $(selector){return document.querySelector(selector)}function $$(selector){var elements={nodeList:document.querySelectorAll(selector),arr:[]};for(var i=0;i<elements.nodeList.length;i++){elements.arr.push(elements.nodeList[i])}return elements.arr}function noop(){}var ibm=window.ibm||{};ibm={flickr:{baseUrl:"https://api.flickr.com/services/rest/",options:{method:"flickr.people.getPublicPhotos",api_key:"a5e95177da353f58113fd60296e1d250",user_id:"24662369@N07",format:"json",nojsoncallback:1,extras:"date_upload,date_taken,geo,views"},getEndpoint:function(){return this.baseUrl+"?"+ibm.utils.toQueryString(this.options)}},init:function(){this.getPhotos()},getPhotos:function(){var endpoint=this.flickr.getEndpoint();ibm.utils.get(endpoint,{success:function(res){var data=JSON.parse(res);if(!data||data.stat!=="ok"){return alert("An error occurred.")}var photos=data.photos.photo.map(function(p){return{id:p.id,standard:"https://farm"+p.farm+".staticflickr.com/"+p.server+"/"+p.id+"_"+p.secret+".jpg",hiRes:"https://farm"+p.farm+".staticflickr.com/"+p.server+"/"+p.id+"_"+p.secret+"_b.jpg",title:p.title,dateTaken:p.datetaken,views:p.views}});ibm.attachPhotosToDom(photos)},error:function(msg){alert(msg)}})},attachPhotosToDom:function(photoCollection){photoCollection.forEach(function(p){var wrapper=document.createElement("div");wrapper.classList.add("photo-wrapper");wrapper.dataset.hiRes=p.hiRes;wrapper.dataset.title=p.title;wrapper.dataset.views=p.views;if(p.hasOwnProperty("dateTaken")&&typeof dateTaken==="string"){wrapper.dataset.dateTaken=p.dateTaken.split(" ")[0]}else{}wrapper.dataset.id=p.id;var info=document.createElement("span");info.classList.add("photo-info");info.innerText=p.title;var img=new Image;img.src=p.standard;img.classList.add("photo-item");img.onload=function(){img.classList.add("loaded")};wrapper.appendChild(img);wrapper.appendChild(info);$("#photo-list").appendChild(wrapper)})}};ibm.utils={promise:function(endpoint,options){if(options===void 0){options={success:noop,error:noop,data:{},method:"GET"}}var method=options.method||"GET";return new Promise(function(resolve,reject){var req=new XMLHttpRequest;req.open(method,endpoint);req.onload=function(){if(req.status==200){resolve(req.response)}else{reject(Error(req.statusText))}};req.onerror=function(){reject(Error("Something went wrong ... "))};var data=ibm.utils.toQueryString(options.data)||"";req.send(data)})},get:function(endpoint,options){if(options===void 0){options={success:noop,error:noop,data:{}}}var req=new XMLHttpRequest;req.open("GET",endpoint);req.onload=function(){if(req.status==200){options.success(req.response)}else{options.error(req.statusText)}};req.onerror=function(){options.error("Something went wrong")};var data=ibm.utils.toQueryString(options.data);req.send(data)},toQueryString:function(obj){if(typeof obj!=="object"||Object.keys(obj).length===0){return""}var qs="";for(var key in obj){var val=obj[key];if(!qs.length){qs+=encodeURIComponent(key)+"="+encodeURIComponent(val)}else{qs+="&"+encodeURIComponent(key)+"="+encodeURIComponent(val)}}return qs}};ibm.init();
"use strict";function $(selector){return document.querySelector(selector)}function $$(selector){var elements={nodeList:document.querySelectorAll(selector),arr:[]};for(var i=0;i<elements.nodeList.length;i++){elements.arr.push(elements.nodeList[i])}return elements.arr}function noop(){}HTMLElement.prototype.on=HTMLElement.prototype.addEventListener;var ibm=window.ibm||{};ibm={flickr:{baseUrl:"https://api.flickr.com/services/rest/",options:{method:"flickr.people.getPublicPhotos",api_key:"a5e95177da353f58113fd60296e1d250",user_id:"24662369@N07",format:"json",nojsoncallback:1,extras:"date_upload,date_taken,geo,views"},getEndpoint:function(){return this.baseUrl+"?"+ibm.utils.toQueryString(this.options)}},init:function(){this.getPhotos();this.streamControls();$$(".cycle-photo").forEach(function(el){el.on("click",function(){var visibleElements=$$(".photo-wrapper").filter(function(el){return!el.classList.contains("stream-hidden")});var maxIndex=visibleElements.length-1;var currentIndex=parseInt($(".active-controls").dataset.index,10);var delta=parseInt(this.dataset.delta,10);var nextIndex=(currentIndex+delta)%maxIndex;if(nextIndex<0)nextIndex=maxIndex;var nextWrapper=$('.photo-wrapper[data-index="'+nextIndex+'"]');console.log(nextIndex,nextWrapper);ibm.makePhotoActive(nextWrapper)},false)});$("#close-active").on("click",function(){$("#active-container").style.display="none";ibm.utils.removeClassAll("active-wrapper")},false)},getPhotos:function(){var endpoint=this.flickr.getEndpoint();ibm.utils.get(endpoint,{success:function(res){var data=JSON.parse(res);if(!data||data.stat!=="ok"){return alert("An error occurred.")}var photos=data.photos.photo.map(function(p){return{id:p.id,standard:"https://farm"+p.farm+".staticflickr.com/"+p.server+"/"+p.id+"_"+p.secret+".jpg",hiRes:"https://farm"+p.farm+".staticflickr.com/"+p.server+"/"+p.id+"_"+p.secret+"_b.jpg",title:p.title,dateTaken:p.datetaken,views:p.views}});ibm.attachPhotosToDom(photos)},error:function(msg){alert(msg)}})},attachPhotosToDom:function(photoCollection){var photoListEl=$("#photo-list");photoCollection.forEach(function(p,index){var wrapper=ibm.createPhotoWrapper(p,index);var title=ibm.createPhotoTitle(p.title);var img=new Image;img.src=p.standard;img.classList.add("photo-item");img.onload=function(){img.classList.add("loaded");if(img.width>img.height){wrapper.classList.add("wider")}else{wrapper.classList.add("taller")}};wrapper.appendChild(img);wrapper.appendChild(title);photoListEl.appendChild(wrapper)});ibm.checkStreamContainerWidth();ibm.photoListeners()},createPhotoWrapper:function(photo,index){var wrapper=document.createElement("div");wrapper.classList.add("photo-wrapper");wrapper.dataset.url=photo.standard;wrapper.dataset.title=photo.title;wrapper.dataset.views=photo.views;wrapper.dataset.id=photo.id;wrapper.dataset.dateTaken=photo.dateTaken.split(" ")[0];wrapper.dataset.index=wrapper.dataset.initIndex=index;return wrapper},createPhotoTitle:function(title){var el=document.createElement("span");el.classList.add("photo-info");el.innerText=title;return el},photoListeners:function(){$$(".photo-wrapper").forEach(function(wrapper){var img=wrapper.querySelector("img.photo-item");img.on("click",function(){ibm.makePhotoActive(wrapper)},false)})},makePhotoActive:function(wrapper){if(wrapper===void 0){return console.log("bah")}var activeContainer=$("#active-container");ibm.utils.removeClassAll("active-wrapper");wrapper.classList.add("active-wrapper");var hiRes=new Image;hiRes.classList.add("hi-res");hiRes.src=wrapper.dataset.url;hiRes.onload=function(){activePhoto.innerHTML="";activePhoto.appendChild(hiRes);hiRes.classList.add("loaded")};var activePhoto=activeContainer.querySelector("#active-photo");activeContainer.querySelector("#title").textContent=wrapper.dataset.title;activeContainer.querySelector("#date-taken").textContent=wrapper.dataset.dateTaken;activeContainer.querySelector("#views").textContent=wrapper.dataset.views;activeContainer.style.display="block";activeContainer.querySelector(".active-controls").dataset.index=wrapper.dataset.index},streamControls:function(){$("#stream-search").on("click",function(){var searchBar=$("#search-term");var term=searchBar.value;ibm.filterPhotosByTitle(term)},false);$("#stream-sorts").on("change",function(){var option=this.querySelector('[value="'+this.value+'"]');ibm.sortPhotos(option.dataset.attribute,option.dataset.sort)},false);$("#reset-stream").on("click",function(){ibm.utils.removeClassAll("stream-hidden");ibm.sortPhotos("index","asc")})},getPhotoList:function(){return $$(".photo-wrapper").map(function(p){return{id:p.dataset.id,url:p.dataset.url,title:p.dataset.title,dateTaken:p.dataset.dateTaken,views:p.dataset.views,index:p.dataset.initIndex,el:p}})},sortPhotos:function(attribute,sortDir){var list=this.getPhotoList();var sorted=null;if(attribute==="dateTaken"){sorted=list.sort(function(a,b){var aMS=Date.parse(a.dateTaken);var bMS=Date.parse(b.dateTaken);if(sortDir==="asc")return aMS-bMS;else return bMS-aMS})}else{sorted=list.sort(function(a,b){if(sortDir==="asc")return a[attribute]-b[attribute];else return b[attribute]-a[attribute]})}this.appendFilteredPhotos(sorted)},filterPhotosByTitle:function(searchText){var regex=new RegExp(searchText,"gi");var photoList=this.getPhotoList();var visibleIndex=0;photoList.forEach(function(p){if(!regex.test(p.title)){p.el.classList.add("stream-hidden");p.el.dataset.index=""}else{p.el.dataset.index=visibleIndex++}})},appendFilteredPhotos:function(photoArray){var photoListEl=$("#photo-list");photoListEl.innerHTML="";photoArray.forEach(function(p,index){p.el.dataset.index=index;photoListEl.appendChild(p.el)})},checkStreamContainerWidth:function(){var list=$("#photo-list");var rectData=list.getBoundingClientRect();if(rectData.width<400){var newEdgeLength=rectData.width*.5+"px";$$(".photo-wrapper").forEach(function(wrap){wrap.style.width=newEdgeLength;wrap.style.height=newEdgeLength})}}};ibm.utils={get:function(endpoint,options){if(options===void 0){options={success:noop,error:noop,data:{}}}var req=new XMLHttpRequest;req.open("GET",endpoint);req.onload=function(){if(req.status==200){options.success(req.response)}else{options.error(req.statusText)}};req.onerror=function(){options.error("Something went wrong")};var data=ibm.utils.toQueryString(options.data);req.send(data)},toQueryString:function(obj){if(typeof obj!=="object"||Object.keys(obj).length===0){return""}var qs="";for(var key in obj){var val=obj[key];if(!qs.length){qs+=encodeURIComponent(key)+"="+encodeURIComponent(val)}else{qs+="&"+encodeURIComponent(key)+"="+encodeURIComponent(val)}}return qs},removeClassAll:function(className){$$("."+className).forEach(function(el){el.classList.remove(className)})}};ibm.init();